/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Controllers;

import DAO.UsuarioDAO;
import Mapeamento.HibernateUtil;
import Mapeamento.TbCliente;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;
import javax.swing.JOptionPane;
import javax.validation.Valid;
import org.hibernate.Session;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

/**
 *
 * @author admingbd
 */
@Controller
public class CadastroClienteController {
    @RequestMapping("cadastrar")
    public String retornaCadastro(Model model){
        model.addAttribute("TbCliente", new TbCliente());
        return "cadastrar";
    }
    
    @RequestMapping("salvarUsuario")
    public String salvarUsuario(@ModelAttribute("TbCliente") TbCliente cliente, BindingResult result, HttpServletRequest request, RedirectAttributes redirectAttributes) {
        
            //if (cliente.getCpf() == 0) {
            //System.out.println("É obrigatório digitar um CPF!");
        
        System.out.println("Vendo o que sera passado");
        System.out.println(cliente.getNomecli());
        System.out.println(cliente.getCpf());
        System.out.println(cliente.getEmailcli());
        System.out.println(cliente.getSenhacli());
        System.out.println(cliente.getRuacli());
        System.out.println(cliente.getNumerocli());
        System.out.println(cliente.getBairrocli());
        System.out.println(cliente.getCidadecli());
        System.out.println(cliente.getEstadocli());
        System.out.println("FIM DOS TESTES");

        UsuarioDAO userDAO = new UsuarioDAO();

        if (userDAO.buscarLogin(cliente) != null) {
            System.out.println("Erro no cadastro!");
            return "redirect:cadastrar";
        }

        if (userDAO.salvarUsuario(cliente)) {
            System.out.println("Cadastro efetuado com sucesso!");            
        } 
        
        else {
            System.out.println("Cadastro não efetuado!");
        }
        
        return "index"; 
    }
}
